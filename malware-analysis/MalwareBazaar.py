import requests
from malware import *
from colors import *


class MalwareBazaar:
    @staticmethod
    def get_recent_list(API_URL, MB_API_KEY):
        """
        Retrieves the recent list of Malware using the Malware Bazaar API.
        """

        headers = { "API-KEY": MB_API_KEY }
        data = {'query': 'get_recent', 'selector': "100"}

        print(info + "Fetching list...")
        response = requests.post(API_URL, headers=headers, data=data)

        return response.json()["data"]
        
    @staticmethod
    def download_malware(sha256_hash, API_URL, MB_API_KEY):
        """
        Downloads the Malware with the specified Sha256 hash using the Malware Bazaar API.
        """
        
        headers = { "API-KEY": MB_API_KEY }
        data = { 'query': "get_file", "sha256_hash": sha256_hash }
        
        get_file_response = requests.post(API_URL, headers=headers, data=data)
        with open("dropbox/" + sha256_hash + ".zip", "wb") as f:
            f.write(get_file_response.content)
        
